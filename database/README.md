# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è Cynical Circle

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Cynical Circle.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
database/
‚îú‚îÄ‚îÄ schema.sql                 # –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ init.sql                   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ setup.sh                   # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ database.py                # –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îú‚îÄ‚îÄ requirements.txt           # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ migrations/                # –ü–∞–ø–∫–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
    ‚îú‚îÄ‚îÄ 001_initial_schema.sql
    ‚îú‚îÄ‚îÄ 002_functions_and_triggers.sql
    ‚îî‚îÄ‚îÄ 003_views_and_functions.sql
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

**macOS (—Å Homebrew):**
```bash
brew install postgresql
brew services start postgresql
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

**Windows:**
–°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞: https://www.postgresql.org/download/windows/

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É database
cd database

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
./setup.sh

# –ò–ª–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
./setup.sh [database_name] [username] [password] [host] [port]
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- `id` (UUID) - –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `username` (VARCHAR) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
- `email` (VARCHAR) - Email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `password_hash` (VARCHAR) - –•–µ—à –ø–∞—Ä–æ–ª—è
- `is_active` (BOOLEAN) - –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `status` (ENUM) - –≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
- `created_at` (TIMESTAMP) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### posts (–ü–æ—Å—Ç—ã)
- `id` (UUID) - –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `title` (VARCHAR) - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞
- `content` (TEXT) - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞
- `owner_id` (UUID) - ID –∞–≤—Ç–æ—Ä–∞ (FK –Ω–∞ users.id)
- `created_at` (TIMESTAMP) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### reactions (–†–µ–∞–∫—Ü–∏–∏)
- `id` (UUID) - –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `post_id` (UUID) - ID –ø–æ—Å—Ç–∞ (FK –Ω–∞ posts.id)
- `user_id` (UUID) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FK –Ω–∞ users.id)
- `reaction_type` (ENUM) - –¢–∏–ø —Ä–µ–∞–∫—Ü–∏–∏
- `created_at` (TIMESTAMP) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á: (post_id, user_id)

#### comments (–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- `id` (UUID) - –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `post_id` (UUID) - ID –ø–æ—Å—Ç–∞ (FK –Ω–∞ posts.id)
- `owner_id` (UUID) - ID –∞–≤—Ç–æ—Ä–∞ (FK –Ω–∞ users.id)
- `content` (TEXT) - –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `created_at` (TIMESTAMP) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### ENUM —Ç–∏–ø—ã

#### user_status
- `contemplating_the_void` - "–†–∞–∑–º—ã—à–ª—è–µ—Ç –æ –ø—É—Å—Ç–æ—Ç–µ"
- `pretending_to_work` - "–ü—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç"
- `on_the_verge` - "–ù–∞ –≥—Ä–∞–Ω–∏"
- `running_on_caffeine` - "–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–æ—Ñ–µ–∏–Ω–µ"

#### reaction_type
- `sigh` - "–í–∑–¥–æ—Ö" üòÆ‚Äçüí®
- `facepalm` - "–§–µ–π—Å–ø–∞–ª–º" ü§¶
- `cringe` - "–ö—Ä–∏–Ω–∂" üò¨
- `seen` - "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ" üëÅÔ∏è

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

#### posts_with_reactions
–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ—Å—Ç—ã —Å –∏—Ö —Ä–µ–∞–∫—Ü–∏—è–º–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.

#### posts_with_stats
–î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤) –∫ –ø–æ—Å—Ç–∞–º.

### –§—É–Ω–∫—Ü–∏–∏

#### add_or_update_reaction()
–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é —Ä–µ–∞–∫—Ü–∏—é –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é.

#### get_system_stats()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```python
from database.database import db

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
await db.connect()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
users = await db.get_users()
posts = await db.get_posts()

# –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
await db.close()
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://cynical_app:secure_password_123@localhost:5432/cynical_circle

# –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
DB_HOST=localhost
DB_PORT=5432
DB_NAME=cynical_circle
DB_USER=cynical_app
DB_PASSWORD=secure_password_123
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
psql -U cynical_app -d cynical_circle -f migrations/001_initial_schema.sql
psql -U cynical_app -d cynical_circle -f migrations/002_functions_and_triggers.sql
psql -U cynical_app -d cynical_circle -f migrations/003_views_and_functions.sql
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `migrations/` —Å –Ω–æ–º–µ—Ä–æ–º —Å–ª–µ–¥—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
2. –î–æ–±–∞–≤—å—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `setup.sh` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–°–∫—Ä–∏–ø—Ç `init.sql` —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ—Å—Ç—ã, —Ä–µ–∞–∫—Ü–∏–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- `cynical_admin` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `sarcastic_user` - –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `jaded_developer` - –£—Å—Ç–∞–≤—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
- `existential_crisis` - –≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å
- `optimistic_pessimist` - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π –ø–µ—Å—Å–∏–º–∏—Å—Ç

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ò–Ω–¥–µ–∫—Å—ã
–°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
- –ü–æ email –∏ username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ owner_id –∏ created_at –ø–æ—Å—Ç–æ–≤
- –ü–æ post_id, user_id –∏ reaction_type —Ä–µ–∞–∫—Ü–∏–π
- –ü–æ post_id, owner_id –∏ created_at –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### –ü—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π asyncpg –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ —Ö–µ—à–µ–π
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è prepared statements –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- CASCADE —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
SELECT * FROM pg_stat_activity WHERE datname = 'cynical_circle';

-- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
SELECT pg_size_pretty(pg_database_size('cynical_circle'));

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü
SELECT schemaname, tablename, n_tup_ins, n_tup_upd, n_tup_del 
FROM pg_stat_user_tables;
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PostgreSQL –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏.

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
pg_dump -U cynical_app -h localhost cynical_circle > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
psql -U cynical_app -h localhost cynical_circle < backup.sql
```

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
2. **–û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
3. **–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ PostgreSQL (macOS)
tail -f /usr/local/var/log/postgres.log

# –õ–æ–≥–∏ PostgreSQL (Ubuntu)
tail -f /var/log/postgresql/postgresql-*.log
```
